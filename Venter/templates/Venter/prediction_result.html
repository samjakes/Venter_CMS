{% extends 'Venter/base.html' %}
{% block title %}Prediction Results{% endblock %}
{% block content %}

<link rel="stylesheet" href="../../static/assets/css/prediction_result.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="../../static/assets/js/download.js"></script>

<script>
  $(document).ready(function () {
    // if($('.nav-tabs li:eq(0)').hasClass('active')){
    //   var link = $('.nav-tabs li.active a').prop('href');
    //   console.log(link);
    //   if($('.nav-pills li:eq(0)').hasClass('active')){
    //     $('.nav-pills li:eq(0) a').tab('show');
    //     console.log("graph pill is active")
    //   }
    // }

    if ($('.nav-pills li:eq(0)').hasClass('active')) {
      $('.nav-pills li:eq(0) a').tab('show');
    }

    $("#chart-download-container").hide();

    // $(document).on("click", "#graph", function () {
    //  var domain_name = $(this).data('id');
    //  console.log("DOMAIN NAME SELECTED: ");
    //  console.log(domain_name);
    //  $("#chart-download-container #domain_title").val( domain_name );
    // });

    // if ($('.nav-pills li').click(function(event) {
    //   $('.nav-pills li').removeClass('active');
    //   $(this).addClass('active');
    //   $(this).tab('show');
    // });


    // $('.nav-tabs > li > a').click(function(event){
    //   // event.preventDefault();
    //   var actived_nav = $('.nav-tabs > li.active');
    //   actived_nav.removeClass('active');

    //   $(this).parents('li').addClass('active');
    // }); 
  });
</script>


<script>
  console.log('{{test}}')
  function rndColor() {
    var r = ('0' + Math.floor(Math.random() * 256).toString(16)).substr(-2), // red
      g = ('0' + Math.floor(Math.random() * 256).toString(16)).substr(-2), // green
      b = ('0' + Math.floor(Math.random() * 256).toString(16)).substr(-2); // blue
    return '#' + r + g + b;
  }

  google.charts.load('current', { 'packages': ['corechart'] });
  google.charts.setOnLoadCallback(drawStuff);

  function drawStuff() {
    var stats = '{{ domain_stats|escapejs }}';

    stats = jQuery.parseJSON(stats);
    noOfNovelCats = stats[stats.length - 1].length - 2

    colorseries = {}
    for (i = 0; i < noOfNovelCats; i++) {
      colorseries[i] = rndColor()
    }

    var data = new google.visualization.arrayToDataTable(stats);

    var options = {
      width: '1100',
      height: '600',
      isStacked: true,
      legend: {
        position: 'none'
      },
      title: '{{chart_domain}}',
      titleTextStyle: {
        fontName: 'Times New Roman',
        fontSize: 30,
        bold: true,
        italic: false,
        color: '#000099',
      },
      titlePosition: 'out',
      hAxis: {
        title: 'Category',
        titleTextStyle: {
          'fontSize': 23,
          color: 'black',
          bold: true,
          italic: false,
        },
        'textStyle': {
          'fontSize': 15,
          color: 'black',
        },
        gridlines: 3,
        slantedText: true,
        slantedTextAngle: 45,
      },
      vAxis: {
        title: 'Number of responses',
        titleTextStyle: {
          'fontSize': 23,
          color: 'black',
          bold: true,
          italic: false,
        },
        'textStyle': {
          'fontSize': 15,
          color: 'black',
          bold: true,
        },
      },
      bar: {
        groupWidth: "90%"
      },
      series: colorseries,
      is3D: true,
    };
    var chart_div = document.getElementById('chart_div');
    var chart = new google.visualization.ColumnChart(chart_div);
   
    function selectHandler() {
          var selectedItem = chart.getSelection()[0];
          if (selectedItem) {
          var category = data.getValue(selectedItem.row, 0);
          $('#graph').hide();
          $('#cardview').tab('show');
          document.getElementById(category).scrollIntoView();
          } 
        }
    google.visualization.events.addListener(chart, 'select', selectHandler);    

    google.visualization.events.addListener(chart, 'ready', function () {
        var imgUri = chart.getImageURI();
        $('#download_graph-btn').click(function() {
          download(imgUri, "{{chart_domain}}.png", "image/png");
        });
    });
    chart.draw(data, options);
    $("#chart-download-container").show();
  };

</script>


<div class="outer-pr row">
  <div class="content-domain">
    <ul class="nav nav-tabs nav-fill" id="domain_tab" role="tablist">
      {% for domain in domain_list %}
      <!-- {% if domain == domain_list.0 %}
        <li class="nav-item active">
          <a href="{% url 'domain_contents' %}?domain={{domain}}" class="nav-link" data-target="#graph" role="tab"
            aria-selected="true">
            {{domain}}
          </a>
        </li>
        {% else %}
        <li class="nav-item">
          <a href="{% url 'domain_contents' %}?domain={{domain}}" class="nav-link" data-target="#graph" role="tab"
            aria-selected="true">
            {{domain}}
          </a>
        </li>
        {% endif %} -->

      <li class="nav-item">
        <a href="{% url 'domain_contents' %}?domain={{domain}}" class="nav-link" data-target="#graph" role="tab"
          aria-selected="true">
          {{domain}}
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>

  <div class="content-navigator">
    <ul class="nav nav-pills justify-content-center" id="navigator_tab" role="tablist">
      <li class="nav-item active" id="pill-graph">
        <a class="nav-link" data-toggle="pill" href="#graph">
          Graph &nbsp; <i class="fa fa-area-chart chart-fa" aria-hidden="true"></i>
        </a>
      </li>
      <li class="nav-item" id="pill-cardview">
        <a class="nav-link" data-toggle="pill" href="#cardview">
          CardView &nbsp; <i class="fa fa-list-alt list-fa" aria-hidden="true"></i>
        </a>
      </li>
    </ul>
  </div>

  <div class="tab-content">
    <div id="cardview" class="tab-pane fade content-cardview">
      <div class="card-container" id="card-container">
        {% for category,response in domain_data.items %}
        <div class="card" id="{{category}}">
          <div class="card-header">
            <label class="label-category">{{category}}</label>
            <hr>
          </div>
          <div class="card-body">
            <div class="card-text">
              {% if not response %}
              <li class="list-group-item">No response</li>
              {% else %}
              <ul class="list-group list-group-flush">
                {% if category == 'Novel' %}
                {% for keys, item in response.items %}
                <li class="list-group-item">
                  <b>Sub category {{forloop.counter}}</b>
                </li>
                {% for r in item %}
                <li class="list-group-item">
                  {{r}}
                </li>
                {% endfor %}
                {% endfor %}
                {% else %}
                {% for r in response %}
                <li class="list-group-item">{{r}}</li>
                {% endfor %}
                {% endif %}
              </ul>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <div id="graph" class="tab-pane fade content-graph">
      <div id="chart-download-container">
          <button type="button" class="btn btn-primary download_graph-btn" id="download_graph-btn">
              Download graph &nbsp;<i class="fa fa-download download-fa" aria-hidden="true"></i>
          </button>
      </div>  
      <div id="chart_div" class="graph-container"></div>
    </div>
  </div>

</div>

{% endblock %}